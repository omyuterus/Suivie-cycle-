<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mon Suivi de Cycle Expert ğŸŒ™</title>
  <style>
    :root{
      --bg:#fbf7f4; --card:#ffffff; --text:#1f2937; --muted:#6b7280;
      --accent:#a74d5e; --green:#93b087; --dark:#244135; --border:#eadfd7;
      --shadow: 0 10px 30px rgba(31,41,55,.08); --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, sans-serif;
      background: radial-gradient(1200px 600px at 10%, rgba(167,77,94,.08), transparent 50%), var(--bg);
      color:var(--text); line-height: 1.5;
    }
    header, main{ max-width:1200px; margin:0 auto; padding:16px; }
    main{ display:grid; grid-template-columns: 1.1fr 0.9fr; gap:20px; }
    @media (max-width: 1000px){ main{ grid-template-columns:1fr; } }
    .card{ background:var(--card); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); padding:20px; margin-bottom:16px; }
    .card h2{ margin-top:0; color:var(--dark); font-size:18px; border-bottom:1px solid var(--border); padding-bottom:8px;}
    .note{ background: rgba(147,176,135,.10); border:1px dashed var(--green); padding:12px; border-radius:14px; font-size:13px; margin:10px 0; }
    .note2{ background: rgba(167,77,94,.08); border:1px dashed var(--accent); padding:12px; border-radius:14px; font-size:13px; margin:10px 0; }
    
    #magicAdvice{ background: #fff9db; border: 2px solid #fab005; padding:15px; border-radius:14px; font-size:14px; display:none; margin-bottom:15px; animation: fadeIn 0.5s; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    label{ font-size:13px; color:var(--muted); display:block; margin-bottom:5px; font-weight: bold; margin-top:15px; }
    input, select, textarea{ width:100%; padding:12px; border:1px solid var(--border); border-radius:14px; outline:none; font-size:14px; margin-bottom:10px; }
    .chips{ display:flex; flex-wrap:wrap; gap:8px; margin-bottom:10px; }
    .chip{ display:flex; align-items:center; gap:8px; padding:8px 12px; border:1px solid var(--border); border-radius:999px; background:#fff; cursor:pointer; font-size:13px; transition:0.2s; }
    .chip input{ accent-color: var(--accent); width: auto; margin:0; }
    .scale{ display:grid; grid-template-columns: repeat(11, 1fr); gap:4px; }
    .scale input{ appearance:none; height:35px; border:1px solid var(--border); border-radius:8px; cursor:pointer; display:flex; align-items:center; justify-content:center; }
    .scale input:checked{ border:2px solid var(--accent); background: rgba(167,77,94,.1); }
    .scale input::before{ content: attr(title); font-size:11px; }
    button{ border:none; padding:12px 14px; border-radius:14px; cursor:pointer; font-weight:800; font-size:14px; transition:0.2s; }
    .btn-primary{ background:var(--accent); color:#fff; width: 100%; }
    .btn-secondary{ background:rgba(147,176,135,.2); color:var(--dark); margin-top:5px; width:100%; }
    .btn-sos{ background:#e03131; color:#fff; margin-bottom: 10px; }
    .entry{ border:1px solid var(--border); border-radius:15px; padding:15px; margin-bottom:12px; background: rgba(255,255,255,0.5); border-left: 4px solid var(--green); }
    
    .tabs { display: flex; gap: 10px; margin-bottom: 15px; }
    .tab { padding: 10px 20px; border-radius: 999px; border: 1px solid var(--border); background: #fff; cursor: pointer; font-size: 14px; }
    .tab.active { background: var(--accent); color: #fff; border-color: var(--accent); }
  </style>
</head>
<body>

<header>
  <h1>Mon suivi de cycle Expert ğŸŒ™</h1>
  <p style="color:var(--muted); font-size:14px;">Ta santÃ©, tes hormones, ta sÃ©rÃ©nitÃ©.</p>
</header>

<main>
  <section>
    <div class="card">
      <h2>ğŸ“… Mois & Ramadan</h2>
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
        <div><label>Mois</label><input type="month" id="mainMonth" onchange="render()"></div>
        <div><label>Pseudo</label><input type="text" id="nickname" placeholder="ğŸŒ¸"></div>
      </div>
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
        <div><label>DÃ©but rÃ¨gles</label><input type="date" id="startDate"></div>
        <div><label>Fin rÃ¨gles</label><input type="date" id="endDate"></div>
      </div>
      <label>Flux global</label>
      <select id="mainFlow">
        <option value="1">LÃ©ger</option>
        <option value="2">Moyen</option>
        <option value="3">Abondant</option>
        <option value="4">HÃ©morragique âš ï¸</option>
      </select>
      <div class="note2">
        <label><input type="checkbox" id="ramadanMode" style="width:auto;"> Suivi Ramadan (jours Ã  rattraper)</label>
        <div id="ramadanFields" style="display:none; margin-top:10px;">
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
            <div><label>Ã€ rattraper</label><input type="number" id="ramTotal"></div>
            <div><label>Faits</label><input type="number" id="ramDone"></div>
          </div>
        </div>
      </div>
      <button class="btn-secondary" onclick="saveMonth()">Sauvegarder le mois</button>
    </div>

    <div class="card">
      <button class="btn-sos" onclick="alert('âš¡ GESTES SOS DOULEUR :\n1. Bouillotte chaude sur le ventre\n2. Respiration ventrale (5 min)\n3. Tisane de Djeka ou Camomille\n4. Allonge-toi sur le cÃ´tÃ©, genoux repliÃ©s.')">ğŸš¨ SOS Douleur Forte</button>
      
      <h2>â• Ma note du jour</h2>
      <label>Date</label><input type="date" id="entryDate">
      
      <label>Ressentis & Peau</label>
      <div class="chips">
        <label class="chip"><input type="checkbox" name="mood" value="Calme" onchange="giveAdvice()"> ğŸ™‚ Calme</label>
        <label class="chip"><input type="checkbox" name="mood" value="StressÃ©e" onchange="giveAdvice()"> ğŸ˜µ StressÃ©e</label>
        <label class="chip"><input type="checkbox" name="mood" value="FatiguÃ©e" onchange="giveAdvice()"> ğŸ˜´ FatiguÃ©e</label>
        <label class="chip"><input type="checkbox" name="mood" value="Maux de tÃªte" onchange="giveAdvice()"> ğŸ¤• TÃªte</label>
        <label class="chip"><input type="checkbox" name="mood" value="AcnÃ©" onchange="giveAdvice()"> ğŸ”´ AcnÃ© / Peau</label>
        <label class="chip"><input type="checkbox" name="mood" value="Sucre" onchange="giveAdvice()"> ğŸ« Sucre</label>
      </div>

      <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
        <div><label>Sommeil</label><select id="sleep" onchange="giveAdvice()"><option value="bien">Bien</option><option value="moyen">Moyen</option><option value="difficile">Mauvais</option></select></div>
        <div><label>Transit</label><select id="digestion" onchange="giveAdvice()"><option value="normal">Normal</option><option value="diarrhee">DiarrhÃ©e</option><option value="constipee">ConstipÃ©</option></select></div>
      </div>

      <label>Douleurs ?</label>
      <select id="hasPain" onchange="togglePain(); giveAdvice();"><option value="non">Non</option><option value="oui">Oui</option></select>
      <div id="painBlock" style="display:none;">
        <label>IntensitÃ© (0-10)</label><div class="scale" id="painScale" onchange="giveAdvice()"></div>
      </div>

      <div id="magicAdvice"></div>

      <label>Pris aujourd'hui ?</label>
      <div class="chips">
        <label class="chip"><input type="checkbox" name="took" value="Djeka"> ğŸ«– Djeka</label>
        <label class="chip"><input type="checkbox" name="took" value="Bouillotte"> ğŸ”¥ Bouillotte</label>
        <label class="chip"><input type="checkbox" name="took" value="Tisane"> ğŸŒ¼ Tisane</label>
        <label class="chip"><input type="checkbox" name="took" value="Sport"> ğŸƒ Sport</label>
      </div>
      
      <button class="btn-primary" onclick="addEntry()">Enregistrer âœ¨</button>
    </div>
  </section>

  <aside>
    <div class="card">
      <div class="tabs">
        <button class="tab active" id="tabHisto" onclick="showTab('histo')">Notes</button>
        <button class="tab" id="tabGraph" onclick="showTab('graph')">Graphiques ğŸ“Š</button>
      </div>
      <div id="viewHisto">
        <div id="ramadanStatus" class="note2" style="display:none;"></div>
        <div id="entriesList"></div>
      </div>
      <div id="viewGraph" style="display:none;"><canvas id="cycleChart"></canvas></div>
    </div>

    <div class="card">
      <h2>ğŸŒ¿ Guide Naturo</h2>
      <div class="note"><b>Djeka :</b> Ton alliÃ© phare. 1 tasse/j vers l'ovulation et dÃ¨s la douleur de rÃ¨gles.</div>
      <div class="note2"><b>Sommeil :</b> Si tu dors mal avant tes rÃ¨gles, bois de la MÃ©lisse ou Verveine chaque soir pour anticiper.</div>
      <div class="note"><b>Alimentation :</b> Ton assiette gÃ¨re tes hormones. Ã‰vite le sucre raffinÃ© quand tu as mal.</div>
    </div>
  </aside>
</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
const LS_KEY = "cycle_expert_v12";
const scaleDiv = document.getElementById("painScale");
for(let i=0; i<=10; i++){ scaleDiv.innerHTML += `<input type="radio" name="pLvl" value="${i}" title="${i}" ${i===0?'checked':''}>`; }

function togglePain(){ document.getElementById("painBlock").style.display = (document.getElementById("hasPain").value === 'oui' ? 'block' : 'none'); }
document.getElementById("ramadanMode").onchange = function(){ document.getElementById("ramadanFields").style.display = this.checked ? 'block' : 'none'; };

function giveAdvice() {
    const adviceDiv = document.getElementById("magicAdvice");
    let msg = [];
    const moods = Array.from(document.querySelectorAll('input[name="mood"]:checked')).map(e=>e.value);
    
    if(moods.includes("Maux de tÃªte")) msg.push("ğŸ¤• <b>TÃªte :</b> Bois beaucoup d'eau et repose tes yeux.");
    if(moods.includes("AcnÃ©")) msg.push("ğŸ”´ <b>Peau :</b> Tes hormones stimulent le sÃ©bum. Nettoie ta peau en douceur, sans dÃ©caper.");
    if(document.getElementById("digestion").value === "diarrhee") msg.push("ğŸ’¨ <b>Hormones :</b> La diarrhÃ©e est normale, c'est ton utÃ©rus qui fait bouger tes intestins !");
    if(document.getElementById("sleep").value === "difficile") msg.push("ğŸŒ™ <b>Sommeil :</b> Anticipe le mois prochain avec de la Verveine ou MÃ©lisse le soir.");
    if(document.getElementById("hasPain").value === "oui") msg.push("ğŸ«– <b>Djeka :</b> PrÃ©pare ton infusion chaude.");
    
    adviceDiv.innerHTML = msg.join("<br><br>");
    adviceDiv.style.display = msg.length > 0 ? "block" : "none";
}

function getData(){ return JSON.parse(localStorage.getItem(LS_KEY) || '{"months":{}}'); }

function saveMonth(){
  const data = getData(); const m = document.getElementById("mainMonth").value; if(!m) return alert("Mois?");
  data.months[m] = data.months[m] || { entries: [] };
  data.months[m].info = { start: document.getElementById("startDate").value, end: document.getElementById("endDate").value, flow: document.getElementById("mainFlow").value, ramActive: document.getElementById("ramadanMode").checked, ramTotal: document.getElementById("ramTotal").value, ramDone: document.getElementById("ramDone").value };
  localStorage.setItem(LS_KEY, JSON.stringify(data)); render(); alert("Mois enregistrÃ©!");
}

function addEntry(){
  const data = getData(); const m = document.getElementById("mainMonth").value; if(!m) return alert("Mois?");
  const entry = { id: Date.now(), date: document.getElementById("entryDate").value, sleep: document.getElementById("sleep").value, digestion: document.getElementById("digestion").value, moods: Array.from(document.querySelectorAll('input[name="mood"]:checked')).map(e=>e.value), pain: { active: document.getElementById("hasPain").value, lvl: document.querySelector('input[name="pLvl"]:checked').value }, took: Array.from(document.querySelectorAll('input[name="took"]:checked')).map(e=>e.value) };
  data.months[m].entries.push(entry); localStorage.setItem(LS_KEY, JSON.stringify(data)); render();
}

function render(){
  const data = getData(); const m = document.getElementById("mainMonth").value; const list = document.getElementById("entriesList"); const rb = document.getElementById("ramadanStatus");
  list.innerHTML = ""; if(!data.months[m]) return;
  const info = data.months[m].info; if(info && info.ramActive){ rb.style.display="block"; rb.innerHTML = `ğŸŒ™ <b>Ramadan :</b> ${info.ramDone||0}/${info.ramTotal||0} faits.`; } else rb.style.display="none";
  data.months[m].entries.sort((a,b)=>new Date(b.date)-new Date(a.date)).forEach(e=>{
    const d = document.createElement("div"); d.className="entry";
    d.innerHTML = `<b>ğŸ“… ${e.date}</b><br><small>${e.moods.join(' ')} | ğŸŒ¿ ${e.took.join(' ')}</small>`;
    list.appendChild(d);
  });
}

let chart;
function buildCharts(){
  const data = getData(); const ms = Object.keys(data.months).sort();
  const pains = ms.map(m => data.months[m].entries.reduce((a,c)=>a+parseInt(c.pain.lvl),0)/data.months[m].entries.length || 0);
  const flows = ms.map(m => data.months[m].info.flow || 0);
  if(chart) chart.destroy();
  chart = new Chart(document.getElementById("cycleChart"), {
    data: { labels: ms, datasets: [ { type: 'line', label: 'Douleur', data: pains, borderColor: '#a74d5e' }, { type: 'bar', label: 'Flux', data: flows, backgroundColor: 'rgba(147,176,135,0.5)' } ] },
    options: { scales: { y: { min: 0, max: 10 } } }
  });
}

function showTab(t){
  document.getElementById('viewHisto').style.display = t==='histo'?'block':'none';
  document.getElementById('viewGraph').style.display = t==='graph'?'block':'none';
  document.getElementById('tabHisto').classList.toggle('active', t==='histo');
  document.getElementById('tabGraph').classList.toggle('active', t==='graph');
  if(t==='graph') buildCharts();
}
const d = new Date(); document.getElementById("mainMonth").value = d.toISOString().slice(0,7);
document.getElementById("entryDate").value = d.toISOString().slice(0,10); render();
</script>
</body>
</html>
