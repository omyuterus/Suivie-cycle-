<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mon suivi de cycle üåô</title>

  <style>
    :root{
      --bg:#fbf7f4;
      --card:#ffffff;
      --text:#1f2937;
      --muted:#6b7280;
      --accent:#a74d5e;
      --accent2:#93b087;
      --accent3:#244135;
      --border:#eadfd7;
      --shadow: 0 10px 30px rgba(31,41,55,.08);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(167,77,94,.10), transparent 60%),
                  radial-gradient(1000px 500px at 90% 20%, rgba(147,176,135,.14), transparent 60%),
                  var(--bg);
      color:var(--text);
      line-height: 1.5;
    }
    header{ padding:24px 16px; max-width:1120px; margin:0 auto; }
    h1{ margin:0; font-size:26px; color: var(--accent3); }
    .badge-container{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
    .badge{ font-size:12px; padding:6px 12px; border:1px solid var(--border); border-radius:999px; background:rgba(255,255,255,.7); color:var(--muted); }
    
    main{ max-width:1120px; margin:0 auto; padding:16px; display:grid; grid-template-columns: 1.1fr .9fr; gap:20px; }
    @media (max-width: 1000px){ main{ grid-template-columns:1fr; } }

    .card{ background:var(--card); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); padding:20px; margin-bottom:20px; }
    .card h2{ margin:0 0 15px; font-size:18px; color:var(--accent3); border-bottom: 1px solid var(--border); padding-bottom: 8px; }
    
    label{ font-size:14px; font-weight: 600; color:var(--text); display:block; margin-bottom:8px; margin-top:16px;}
    input, select, textarea { width:100%; padding:12px; border:1px solid var(--border); border-radius:14px; outline:none; font-size:15px; background:#fff; transition: border 0.3s; }
    input:focus, select:focus{ border-color: var(--accent); }
    
    .row{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    @media (max-width:600px){ .row{ grid-template-columns:1fr; } }

    .chips{ display:flex; flex-wrap:wrap; gap:10px; margin-top:8px;}
    .chip{ display:flex; align-items:center; gap:8px; padding:10px 16px; border:1px solid var(--border); border-radius:999px; background:#fff; cursor:pointer; font-size:14px; transition: 0.2s; }
    .chip:hover{ background: var(--bg); }
    .chip input{ width:auto; accent-color: var(--accent); margin:0;}

    .scale-container{ margin-top: 10px; }
    .scale{ display:grid; grid-template-columns: repeat(11, 1fr); gap:4px; }
    .scale input{ appearance:none; height:40px; border:1px solid var(--border); border-radius:10px; cursor:pointer; display:flex; align-items:center; justify-content:center; padding: 0;}
    .scale input:checked{ border:2px solid var(--accent); background:rgba(167,77,94,0.1); font-weight: bold; }
    .scale input::before{ content: attr(title); font-size:12px; }

    button{ border:none; padding:14px 20px; border-radius:14px; cursor:pointer; font-weight:800; font-size:15px; transition: all 0.2s; width: 100%; }
    .btn-primary{ background:var(--accent); color:#fff; box-shadow: 0 4px 12px rgba(167,77,94,0.2); }
    .btn-primary:hover{ opacity: 0.9; transform: translateY(-1px); }
    .btn-secondary{ background:rgba(147,176,135,0.2); color:var(--accent3); margin-top: 10px; }
    .btn-ghost{ background:transparent; border:1px solid var(--border); color:var(--muted); margin-top: 10px;}

    .note{ background: rgba(147,176,135,.12); border:1px dashed var(--accent2); padding:12px; border-radius:14px; font-size:13px; margin:12px 0; color: var(--accent3); }
    .note2{ background: rgba(167,77,94,.08); border:1px dashed var(--accent); padding:12px; border-radius:14px; font-size:13px; margin:12px 0; }
    
    .pill{ padding:5px 12px; border-radius:999px; border:1px solid var(--border); background:#fff; font-size:12px; display:inline-block; margin:3px; font-weight: 500;}
    .entry-item{ border:1px solid var(--border); border-radius:18px; padding:16px; background:rgba(255,255,255,0.5); margin-bottom:12px; position: relative;}
    .strong{ font-weight:800; color:var(--accent3); }
    
    .tabs{ display:flex; gap:10px; margin-bottom:20px; overflow-x: auto; padding-bottom: 5px; }
    .tab{ padding:10px 18px; border-radius:999px; border:1px solid var(--border); background:#fff; cursor:pointer; font-size:14px; white-space: nowrap; color:var(--muted); flex-shrink: 0; }
    .tab.active{ color:var(--accent3); border-color: var(--accent); background: rgba(167,77,94,0.05); font-weight: 600; }
    
    canvas{ width:100% !important; max-height:280px; margin-top: 10px;}
  </style>
</head>

<body>

<header>
  <h1>Mon suivi de cycle üåô</h1>
  <div class="badge-container">
    <span class="badge">Anonyme & Personnel</span>
    <span class="badge">Donn√©es stock√©es sur ton t√©l√©phone</span>
    <span class="badge">Expert Naturo</span>
  </div>
</header>

<main>
  <section>
    <div class="card">
      <h2>üìÖ Configuration du mois</h2>
      <div class="row">
        <div><label>Mois en cours</label><input type="month" id="mainMonth"></div>
        <div><label>Pr√©nom / Pseudo</label><input type="text" id="nickname" placeholder="Lili, üå∏..."></div>
      </div>
      <div class="row">
        <div><label>D√©but des r√®gles</label><input type="date" id="startDate"></div>
        <div><label>Fin des r√®gles</label><input type="date" id="endDate"></div>
      </div>
      
      <div class="note2">
        <label style="margin:0; cursor:pointer; display: flex; align-items: center; gap: 8px;">
          <input type="checkbox" id="ramadanMode" style="width:auto; margin:0;"> üåô Suivi Ramadan (jours √† rattraper)
        </label>
        <div id="ramadanFields" style="display:none; margin-top:15px;">
            <div class="row">
                <div><label>Total √† rattraper</label><input type="number" id="ramTotal" placeholder="Ex: 7"></div>
                <div><label>D√©j√† rattrap√©s</label><input type="number" id="ramDone" placeholder="Ex: 2"></div>
            </div>
        </div>
      </div>
      <button class="btn-secondary" onclick="saveMonthInfo()">Enregistrer les infos du mois</button>
    </div>

    <div class="card">
      <h2>‚ûï Ajouter une note du jour</h2>
      <label>Date du jour</label>
      <input type="date" id="entryDate">

      <label>Comment te sens-tu ? (humeur / √©nergie)</label>
      <div class="chips">
        <label class="chip"><input type="checkbox" name="mood" value="Calme"> üôÇ Calme</label>
        <label class="chip"><input type="checkbox" name="mood" value="Stress√©e"> üòµ Stress√©e</label>
        <label class="chip"><input type="checkbox" name="mood" value="Fatigu√©e"> üò¥ Fatigu√©e</label>
        <label class="chip"><input type="checkbox" name="mood" value="Irritable"> üò§ Irritable</label>
        <label class="chip"><input type="checkbox" name="mood" value="Sensible"> ü•∫ Sensible</label>
        <label class="chip"><input type="checkbox" name="mood" value="Envie de sucre"> üç´ Envie de sucre</label>
        <label class="chip"><input type="checkbox" name="mood" value="Ballonn√©e"> üéà Ballonn√©e</label>
      </div>

      <label>As-tu des douleurs aujourd'hui ?</label>
      <select id="hasPain" onchange="togglePainFields()">
        <option value="non">Non, tout va bien</option>
        <option value="oui">Oui, j'ai mal</option>
      </select>

      <div id="painFields" style="display:none;">
        <label>O√π se situe la douleur ?</label>
        <div class="chips">
          <label class="chip"><input type="checkbox" name="where" value="Bas-ventre"> Bas-ventre</label>
          <label class="chip"><input type="checkbox" name="where" value="Dos / Reins"> Dos / Reins</label>
          <label class="chip"><input type="checkbox" name="where" value="Seins"> Seins</label>
          <label class="chip"><input type="checkbox" name="where" value="T√™te"> T√™te</label>
        </div>
        <label>Intensit√© (0 = rien, 10 = tr√®s fort)</label>
        <div class="scale" id="painScale"></div>
      </div>

      <label>Qu'as-tu utilis√© pour te soulager ?</label>
      <div class="chips">
        <label class="chip"><input type="checkbox" name="took" value="Bouillotte"> üî• Bouillotte</label>
        <label class="chip"><input type="checkbox" name="took" value="Djeka / Khamar√©"> ü´ñ Djeka / Khamar√©</label>
        <label class="chip"><input type="checkbox" name="took" value="Tisane Camomille/M√©lisse"> üåº Tisane douce</label>
        <label class="chip"><input type="checkbox" name="took" value="M√©dicament"> üíä M√©dicament</label>
        <label class="chip"><input type="checkbox" name="took" value="Repos / Sieste"> üò¥ Repos</label>
        <label class="chip"><input type="checkbox" name="took" value="Rien"> ü§ç Rien</label>
      </div>

      <label>Est-ce que cela t'a aid√©e ?</label>
      <select id="wasHelpful">
        <option value="">Choisir...</option>
        <option value="Oui beaucoup">Oui beaucoup</option>
        <option value="Un peu">Un peu</option>
        <option value="Pas vraiment">Pas vraiment</option>
      </select>

      <label>Notes libres (facultatif)</label>
      <textarea id="dailyNotes" placeholder="Sommeil, alimentation, sport, ou juste ce que tu as sur le coeur..."></textarea>

      <button class="btn-primary" style="margin-top:20px;" onclick="addEntry()">Enregistrer ma note du jour ‚ú®</button>
    </div>
  </section>

  <aside>
    <div class="card">
      <h2>üåø Solutions Naturelles</h2>
      <div class="note"><b>Douleur imm√©diate :</b> Chaleur (bouillotte), positions f≈ìtales et respiration ventrale lente.</div>
      <div class="note2"><b>Djeka / Khamar√© :</b> Id√©al en infusion chaude. Aide √† apaiser les contractions ut√©rines.</div>
      <div class="note"><b>Tisanes :</b> M√©lisse pour le stress, Camomille pour les spasmes, Verveine pour la digestion.</div>
    </div>

    <div class="card">
      <h2>üìä Mon R√©capitulatif</h2>
      <div class="tabs">
        <button class="tab active" data-tab="entries" onclick="switchTab('entries')">Notes du mois</button>
        <button class="tab" data-tab="charts" onclick="switchTab('charts')">Graphiques</button>
      </div>

      <div id="view-entries">
        <div id="ramadanStatus" class="note" style="display:none;"></div>
        <div id="entriesList"></div>
      </div>

      <div id="view-charts" style="display:none;">
        <canvas id="painChart"></canvas>
        <div style="height:20px"></div>
        <canvas id="durationChart"></canvas>
      </div>

      <div class="divider" style="height: 1px; background: var(--border); margin: 20px 0;"></div>
      <button class="btn-ghost" onclick="exportData()">Exporter mes donn√©es (JSON)</button>
      <button class="btn-ghost" style="color:#dc2626; border-color:#fee2e2;" onclick="clearAll()">Vider l'historique</button>
    </div>
  </aside>
</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
const LS_KEY = "cycle_data_full_expert";

// --- INITIALISATION ---
const scaleDiv = document.getElementById("painScale");
for(let i=0; i<=10; i++){
    scaleDiv.innerHTML += `<input type="radio" name="pLevel" value="${i}" title="${i}" ${i===0?'checked':''}>`;
}

function togglePainFields() {
    document.getElementById("painFields").style.display = document.getElementById("hasPain").value === 'oui' ? 'block' : 'none';
}

document.getElementById("ramadanMode").onchange = function() {
    document.getElementById("ramadanFields").style.display = this.checked ? 'block' : 'none';
};

// --- DATA ---
function getData() { return JSON.parse(localStorage.getItem(LS_KEY) || '{"months":{}}'); }

function saveMonthInfo() {
    const data = getData();
    const m = document.getElementById("mainMonth").value;
    if(!m) return alert("Indique le mois d'abord !");
    
    data.months[m] = data.months[m] || { entries: [] };
    data.months[m].info = {
        start: document.getElementById("startDate").value,
        end: document.getElementById("endDate").value,
        nickname: document.getElementById("nickname").value,
        ramActive: document.getElementById("ramadanMode").checked,
        ramTotal: document.getElementById("ramTotal").value,
        ramDone: document.getElementById("ramDone").value
    };
    localStorage.setItem(LS_KEY, JSON.stringify(data));
    render();
    alert("Informations du mois mises √† jour !");
}

function addEntry() {
    const data = getData();
    const m = document.getElementById("mainMonth").value;
    if(!m) return alert("Choisis le mois en haut de la page avant d'ajouter une note.");

    const entry = {
        id: Date.now(),
        date: document.getElementById("entryDate").value,
        moods: Array.from(document.querySelectorAll('input[name="mood"]:checked')).map(e => e.value),
        hasPain: document.getElementById("hasPain").value,
        painLevel: parseInt(document.querySelector('input[name="pLevel"]:checked').value),
        painWhere: Array.from(document.querySelectorAll('input[name="where"]:checked')).map(e => e.value),
        took: Array.from(document.querySelectorAll('input[name="took"]:checked')).map(e => e.value),
        helpful: document.getElementById("wasHelpful").value,
        notes: document.getElementById("dailyNotes").value
    };

    data.months[m] = data.months[m] || { entries: [] };
    data.months[m].entries.push(entry);
    localStorage.setItem(LS_KEY, JSON.stringify(data));
    
    // Reset fields
    document.querySelectorAll('input[type="checkbox"]').forEach(c => { if(!["ramadanMode"].includes(c.id)) c.checked = false; });
    document.getElementById("dailyNotes").value = "";
    document.getElementById("hasPain").value = "non";
    togglePainFields();
    
    render();
    alert("Note du jour enregistr√©e ! ‚ú®");
}

// --- AFFICHAGE & CHARTS ---
let painChart, durationChart;

function switchTab(tab) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
    document.getElementById('view-entries').style.display = tab === 'entries' ? 'block' : 'none';
    document.getElementById('view-charts').style.display = tab === 'charts' ? 'block' : 'none';
    if(tab === 'charts') buildCharts();
}

function render() {
    const data = getData();
    const m = document.getElementById("mainMonth").value;
    const list = document.getElementById("entriesList");
    const ramBox = document.getElementById("ramadanStatus");
    list.innerHTML = "";
    
    if(!data.months[m]) {
        list.innerHTML = "<p style='font-size:13px; color:gray; text-align:center;'>Aucune note pour ce mois encore.</p>";
        ramBox.style.display = "none";
        return;
    }

    const info = data.months[m].info;
    if(info && info.ramActive) {
        ramBox.style.display = "block";
        const reste = (parseInt(info.ramTotal) || 0) - (parseInt(info.ramDone) || 0);
        ramBox.innerHTML = `üåô <b>Rattrapage Ramadan :</b> ${info.ramDone || 0} jours faits sur ${info.ramTotal || 0}. <br><b>Reste √† faire : ${reste > 0 ? reste : 0} jours.</b>`;
    } else { ramBox.style.display = "none"; }

    const entries = data.months[m].entries.sort((a,b) => new Date(b.date) - new Date(a.date));
    entries.forEach(e => {
        const div = document.createElement("div");
        div.className = "entry-item";
        div.innerHTML = `
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                <span class="strong">üìÖ ${e.date}</span>
                <button onclick="deleteEntry('${m}', ${e.id})" style="width:auto; background:none; color:#a74d5e; padding:0; font-size:12px;">Supprimer</button>
            </div>
            <div style="margin-bottom:8px;">
                ${e.moods.map(mo => `<span class="pill">${mo}</span>`).join('')}
            </div>
            ${e.hasPain === 'oui' ? `<div style="font-size:13px; margin-bottom:4px;">üî• Douleur : <b>${e.painLevel}/10</b> (${e.painWhere.join(', ')})</div>` : ''}
            <div style="font-size:13px; color:var(--muted);">üåø Solutions : ${e.took.join(', ') || 'Aucune'}</div>
            ${e.notes ? `<div class="note2" style="margin-top:8px;"><b>Note :</b> ${e.notes}</div>` : ''}
        `;
        list.appendChild(div);
    });
}

function buildCharts() {
    const data = getData();
    const months = Object.keys(data.months).sort();
    const painLevels = months.map(m => {
        const entries = data.months[m].entries;
        if(entries.length === 0) return 0;
        const sum = entries.reduce((acc, curr) => acc + (curr.painLevel || 0), 0);
        return sum / entries.length;
    });
    const durations = months.map(m => {
        const info = data.months[m].info;
        if(!info || !info.start || !info.end) return 0;
        return (new Date(info.end) - new Date(info.start)) / (1000*60*60*24) + 1;
    });

    if(painChart) painChart.destroy();
    if(durationChart) durationChart.destroy();

    painChart = new Chart(document.getElementById("painChart"), {
        type: 'line',
        data: { labels: months, datasets: [{ label: 'Douleur Moyenne', data: painLevels, borderColor: '#a74d5e', tension: 0.3 }] },
        options: { scales: { y: { min: 0, max: 10 } } }
    });

    durationChart = new Chart(document.getElementById("durationChart"), {
        type: 'bar',
        data: { labels: months, datasets: [{ label: 'Dur√©e des r√®gles (jours)', data: durations, backgroundColor: '#93b087' }] }
    });
}

function deleteEntry(month, id) {
    if(!confirm("Supprimer cette note ?")) return;
    const data = getData();
    data.months[month].entries = data.months[month].entries.filter(e => e.id !== id);
    localStorage.setItem(LS_KEY, JSON.stringify(data));
    render();
}

function clearAll() { if(confirm("Supprimer TOUT l'historique ?")) { localStorage.clear(); location.reload(); } }

function exportData() {
    const data = localStorage.getItem(LS_KEY);
    const blob = new Blob([data], {type: "application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "mon-suivi-cycle-export.json";
    a.click();
}

// Initialisation au chargement
const d = new Date();
document.getElementById("mainMonth").value = d.toISOString().slice(0,7);
document.getElementById("entryDate").value = d.toISOString().slice(0,10);
render();
document.getElementById("mainMonth").onchange = render;
</script>

</body>
</html>
