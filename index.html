<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mon suivi de cycle üåô</title>

  <style>
    /* --- DESIGN G√âN√âRAL --- */
    :root {
      --bg: #fbf7f4;
      --card: #ffffff;
      --text: #1f2937;
      --muted: #6b7280;
      --accent: #a74d5e;     /* Rose framboise */
      --accent2: #93b087;    /* Vert sauge */
      --accent3: #244135;    /* Vert fonc√© */
      --border: #eadfd7;
      --shadow: 0 10px 30px rgba(31,41,55,.08);
      --radius: 18px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(167,77,94,.10), transparent 60%),
                  radial-gradient(1000px 500px at 90% 20%, rgba(147,176,135,.14), transparent 60%),
                  var(--bg);
      color: var(--text);
      line-height: 1.6;
    }

    header {
      padding: 30px 20px 10px;
      max-width: 1120px;
      margin: 0 auto;
    }

    .title-group {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    h1 {
      margin: 0;
      font-size: 28px;
      letter-spacing: -0.5px;
      color: var(--accent3);
    }

    .badge {
      font-size: 12px;
      padding: 6px 12px;
      border: 1px solid var(--border);
      border-radius: 999px;
      background: rgba(255,255,255,0.8);
      color: var(--muted);
      font-weight: 500;
    }

    p.lead {
      margin: 15px 0 0;
      color: var(--muted);
      max-width: 800px;
    }

    /* --- LAYOUT --- */
    main {
      max-width: 1120px;
      margin: 0 auto;
      padding: 20px;
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 24px;
    }

    @media (max-width: 1000px) {
      main { grid-template-columns: 1fr; }
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 24px;
      margin-bottom: 24px;
    }

    .card h2 {
      margin: 0 0 15px;
      font-size: 18px;
      color: var(--accent3);
      border-bottom: 1px solid var(--border);
      padding-bottom: 10px;
    }

    /* --- FORMULAIRES --- */
    label {
      font-size: 13px;
      color: var(--muted);
      display: block;
      margin-top: 15px;
      margin-bottom: 6px;
      font-weight: 600;
    }

    input, select, textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 14px;
      outline: none;
      font-size: 15px;
      background: #fff;
      transition: all 0.2s;
    }

    input:focus, select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(167,77,94,0.1);
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    @media (max-width: 600px) {
      .row { grid-template-columns: 1fr; }
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 5px;
    }

    .chip {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      border: 1px solid var(--border);
      border-radius: 999px;
      background: #fff;
      cursor: pointer;
      font-size: 14px;
      transition: 0.2s;
    }

    .chip input { width: auto; margin: 0; accent-color: var(--accent); }

    .scale {
      display: grid;
      grid-template-columns: repeat(11, 1fr);
      gap: 5px;
      margin-top: 10px;
    }

    .scale input {
      appearance: none;
      height: 40px;
      border: 1px solid var(--border);
      border-radius: 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
    }

    .scale input:checked {
      border: 2px solid var(--accent);
      background: rgba(167,77,94,0.08);
    }

    .scale input::before {
      content: attr(title);
      font-size: 12px;
    }

    /* --- BOUTONS --- */
    button {
      border: none;
      padding: 14px 20px;
      border-radius: 14px;
      cursor: pointer;
      font-weight: 800;
      font-size: 15px;
      transition: 0.2s;
    }

    .btn-primary { background: var(--accent); color: #fff; width: 100%; }
    .btn-secondary { background: rgba(147,176,135,0.18); color: var(--accent3); width: 100%; }
    .btn-ghost { background: transparent; border: 1px solid var(--border); color: var(--muted); width: 100%; }

    /* --- NOTES & RECAP --- */
    .note { background: rgba(147,176,135,0.1); border: 1px dashed var(--accent2); padding: 15px; border-radius: 15px; font-size: 13px; margin: 15px 0; }
    .note2 { background: rgba(167,77,94,0.06); border: 1px dashed var(--accent); padding: 15px; border-radius: 15px; font-size: 13px; margin: 15px 0; }
    
    .pill { padding: 5px 12px; border-radius: 999px; border: 1px solid var(--border); background: #fff; font-size: 12px; display: inline-block; margin: 3px; }
    
    .entry-box { border: 1px solid var(--border); border-radius: 18px; padding: 18px; background: rgba(255,255,255,0.6); margin-bottom: 12px; }

    /* --- TABS --- */
    .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
    .tab { padding: 10px 18px; border-radius: 999px; border: 1px solid var(--border); background: #fff; cursor: pointer; color: var(--muted); }
    .tab.active { color: var(--accent3); border-color: var(--accent); background: rgba(167,77,94,0.05); font-weight: 700; }

    #discreetOverlay { position: fixed; inset: 0; background: rgba(36,65,53,0.95); display: none; z-index: 9999; padding: 40px; color: #fff; }
  </style>
</head>

<body>

<div id="discreetOverlay">
  <div style="max-width: 500px; margin: 100px auto; text-align: center;">
    <h2>Mode discret activ√© üôà</h2>
    <p>Tes donn√©es sont masqu√©es.</p>
    <button onclick="document.getElementById('discreetOverlay').style.display='none'" style="background:#fff; color:#000; margin-top:20px;">R√©afficher</button>
  </div>
</div>

<header>
  <div class="title-group">
    <h1>Mon suivi de cycle üåô</h1>
    <span class="badge">Confidentiel</span>
    <span class="badge">Naturopathie</span>
  </div>
  <p class="lead">Un espace doux pour noter tes ressentis et mieux comprendre ton rythme naturel.</p>
</header>

<main>
  <section>
    <div class="card">
      <h2>üìÖ Configuration du mois</h2>
      <div class="row">
        <div><label>Mois</label><input type="month" id="configMonth"></div>
        <div><label>Ton pseudo</label><input type="text" id="pseudo" placeholder="üå∏..."></div>
      </div>
      <div class="row">
        <div><label>Premier jour des r√®gles</label><input type="date" id="dateStart"></div>
        <div><label>Dernier jour des r√®gles</label><input type="date" id="dateEnd"></div>
      </div>
      
      <div class="note2">
        <label style="margin:0; cursor:pointer;"><input type="checkbox" id="checkRamadan" style="width:auto;"> J'ai des jours √† rattraper (Ramadan)</label>
        <div id="ramadanBox" style="display:none; margin-top:15px;">
          <div class="row">
            <div><label>Total √† rattraper</label><input type="number" id="ramTotal" placeholder="ex: 7"></div>
            <div><label>D√©j√† rattrap√©s</label><input type="number" id="ramDone" placeholder="ex: 2"></div>
          </div>
        </div>
      </div>
      <button class="btn-secondary" onclick="saveMonthConfig()">Enregistrer les dates du mois</button>
    </div>

    <div class="card">
      <h2>‚ûï Ta note du jour</h2>
      <div class="actions" style="margin-bottom:15px;">
        <button class="btn-ghost" onclick="document.getElementById('discreetOverlay').style.display='block'">üôà Mode discret</button>
      </div>

      <label>Date de l'entr√©e</label>
      <input type="date" id="entryDate">

      <label>Comment te sens-tu ?</label>
      <div class="chips">
        <label class="chip"><input type="checkbox" name="mood" value="Calme"> üôÇ Calme</label>
        <label class="chip"><input type="checkbox" name="mood" value="Stress√©e"> üòµ Stress√©e</label>
        <label class="chip"><input type="checkbox" name="mood" value="Fatigu√©e"> üò¥ Fatigu√©e</label>
        <label class="chip"><input type="checkbox" name="mood" value="Irritable"> üò§ Irritable</label>
        <label class="chip"><input type="checkbox" name="mood" value="Sensible"> ü•∫ Sensible</label>
        <label class="chip"><input type="checkbox" name="mood" value="Envie de sucre"> üç´ Sucre</label>
      </div>

      <label>As-tu des douleurs aujourd'hui ?</label>
      <select id="painSelect" onchange="togglePain(this.value)">
        <option value="non">Non, tout va bien</option>
        <option value="oui">Oui, j'ai mal</option>
      </select>

      <div id="painDetails" style="display:none;">
        <label>O√π se situe la douleur ?</label>
        <div class="chips">
          <label class="chip"><input type="checkbox" name="pWhere" value="Bas-ventre"> Bas-ventre</label>
          <label class="chip"><input type="checkbox" name="pWhere" value="Dos / Reins"> Dos / Reins</label>
          <label class="chip"><input type="checkbox" name="pWhere" value="Jambes"> Jambes</label>
        </div>
        <label>Intensit√© (0 √† 10)</label>
        <div class="scale" id="painScale"></div>
      </div>

      <label>Qu'as-tu utilis√© pour t'aider ?</label>
      <div class="chips">
        <label class="chip"><input type="checkbox" name="help" value="Bouillotte"> üî• Bouillotte</label>
        <label class="chip"><input type="checkbox" name="help" value="Djeka/Khamar√©"> ü´ñ Djeka/Khamar√©</label>
        <label class="chip"><input type="checkbox" name="help" value="Tisane douce"> üåº Tisane</label>
        <label class="chip"><input type="checkbox" name="help" value="M√©dicament"> üíä M√©dicament</label>
        <label class="chip"><input type="checkbox" name="help" value="Rien"> ü§ç Rien</label>
      </div>

      <label>Est-ce que √ßa t'a soulag√©e ?</label>
      <select id="isHelpful">
        <option value="">Choisir...</option>
        <option>Oui beaucoup</option>
        <option>Un peu</option>
        <option>Pas vraiment</option>
      </select>

      <label>Notes libres (facultatif)</label>
      <textarea id="notes" placeholder="√âcris ici ce que tu veux..."></textarea>

      <button class="btn-primary" style="margin-top:20px;" onclick="addEntry()">Enregistrer ma note ‚ú®</button>
    </div>
  </section>

  <aside>
    <div class="card">
      <h2>üåø Conseils Naturo</h2>
      <div class="note"><b>Douleurs :</b> Chaleur, repos et respirations lentes par le ventre.</div>
      <div class="note2"><b>Djeka / Khamar√© :</b> Infusion chaude. Aide √† apaiser d√®s que la douleur arrive.</div>
      <div class="note"><b>Semaine avant :</b> Camomille ou M√©lisse le soir pour le calme.</div>
    </div>

    <div class="card">
      <h2>üìä Suivi & Historique</h2>
      <div class="tabs">
        <button class="tab active" data-tab="list" onclick="showTab('list')">Notes</button>
        <button class="tab" data-tab="graph" onclick="showTab('graph')">Graphiques</button>
      </div>

      <div id="view-list">
        <div id="ramadanStatus" class="note2" style="display:none;"></div>
        <div id="outputList"></div>
      </div>

      <div id="view-graph" style="display:none;">
        <canvas id="chartPain"></canvas>
        <div style="height:20px"></div>
        <canvas id="chartDays"></canvas>
      </div>

      <div style="margin-top:20px; border-top:1px solid var(--border); padding-top:15px;">
        <button class="btn-ghost" onclick="exportJSON()">Exporter (Fichier JSON)</button>
        <button class="btn-ghost" style="color:red; border-color:#fee2e2; margin-top:10px;" onclick="wipe()">Tout effacer</button>
      </div>
    </div>
  </aside>
</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
const DB_KEY = "naturo_cycle_v4";

// Cr√©ation √©chelle douleur
const sc = document.getElementById("painScale");
for(let i=0; i<=10; i++) {
    sc.innerHTML += `<input type="radio" name="pLvl" value="${i}" title="${i}" ${i===0?'checked':''}>`;
}

// Toggles UI
function togglePain(v) { document.getElementById("painDetails").style.display = (v==='oui'?'block':'none'); }
document.getElementById("checkRamadan").onchange = function() { document.getElementById("ramadanBox").style.display = this.checked ? 'block' : 'none'; };

function getDB() { return JSON.parse(localStorage.getItem(DB_KEY) || '{"months":{}}'); }

function saveMonthConfig() {
    const db = getDB();
    const m = document.getElementById("configMonth").value;
    if(!m) return alert("Pr√©cise le mois !");
    db.months[m] = db.months[m] || { entries: [] };
    db.months[m].config = {
        start: document.getElementById("dateStart").value,
        end: document.getElementById("dateEnd").value,
        pseudo: document.getElementById("pseudo").value,
        ramOn: document.getElementById("checkRamadan").checked,
        ramT: document.getElementById("ramTotal").value,
        ramD: document.getElementById("ramDone").value
    };
    localStorage.setItem(DB_KEY, JSON.stringify(db));
    refresh();
    alert("Config du mois sauvegard√©e !");
}

function addEntry() {
    const db = getDB();
    const m = document.getElementById("configMonth").value;
    if(!m) return alert("Indique d'abord le mois en haut.");

    const entry = {
        id: Date.now(),
        date: document.getElementById("entryDate").value,
        moods: Array.from(document.querySelectorAll('input[name="mood"]:checked')).map(e => e.value),
        pain: document.getElementById("painSelect").value,
        level: document.querySelector('input[name="pLvl"]:checked').value,
        where: Array.from(document.querySelectorAll('input[name="pWhere"]:checked')).map(e => e.value),
        helps: Array.from(document.querySelectorAll('input[name="help"]:checked')).map(e => e.value),
        ok: document.getElementById("isHelpful").value,
        txt: document.getElementById("notes").value
    };

    db.months[m] = db.months[m] || { entries: [] };
    db.months[m].entries.push(entry);
    localStorage.setItem(DB_KEY, JSON.stringify(db));
    
    // Reset
    document.querySelectorAll('input[type="checkbox"]').forEach(c => { if(c.id !== "checkRamadan") c.checked = false; });
    document.getElementById("notes").value = "";
    refresh();
    alert("Note ajout√©e au journal !");
}

let c1, c2;
function showTab(t) {
    document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
    document.querySelector(`[data-tab="${t}"]`).classList.add('active');
    document.getElementById('view-list').style.display = (t==='list'?'block':'none');
    document.getElementById('view-graph').style.display = (t==='graph'?'block':'none');
    if(t==='graph') draw();
}

function refresh() {
    const db = getDB();
    const m = document.getElementById("configMonth").value;
    const list = document.getElementById("outputList");
    const ram = document.getElementById("ramadanStatus");
    list.innerHTML = "";
    
    if(!db.months[m]) {
        ram.style.display = "none";
        return;
    }

    const conf = db.months[m].config;
    if(conf && conf.ramOn) {
        ram.style.display = "block";
        const rest = (conf.ramT || 0) - (conf.ramD || 0);
        ram.innerHTML = `üåô <b>Ramadan :</b> ${conf.ramD || 0} / ${conf.ramT || 0} faits. (Reste : ${rest > 0 ? rest : 0})`;
    } else { ram.style.display = "none"; }

    db.months[m].entries.sort((a,b) => new Date(b.date) - new Date(a.date)).forEach(e => {
        const d = document.createElement("div");
        d.className = "entry-box";
        d.innerHTML = `
            <div style="display:flex; justify-content:space-between;"><b>üìÖ ${e.date}</b> <span onclick="del('${m}', ${e.id})" style="color:red; cursor:pointer; font-size:11px;">Supprimer</span></div>
            <div style="margin-top:8px;">${e.moods.map(x => `<span class="pill">${x}</span>`).join('')}</div>
            ${e.pain === 'oui' ? `<div style="font-size:13px; margin-top:5px;">üî• Douleur ${e.level}/10 (${e.where.join(', ')})</div>` : ''}
            <div style="font-size:12px; color:gray; margin-top:5px;">üåø Utilis√© : ${e.helps.join(', ') || 'Rien'}</div>
            ${e.txt ? `<div class="note" style="margin-top:10px;">${e.txt}</div>` : ''}
        `;
        list.appendChild(d);
    });
}

function draw() {
    const db = getDB();
    const keys = Object.keys(db.months).sort();
    const pData = keys.map(k => {
        const es = db.months[k].entries;
        return es.length ? es.reduce((a,b) => a + parseInt(b.level), 0) / es.length : 0;
    });
    const dData = keys.map(k => {
        const c = db.months[k].config;
        if(!c || !c.start || !c.end) return 0;
        return (new Date(c.end) - new Date(c.start)) / 86400000 + 1;
    });

    if(c1) c1.destroy();
    if(c2) c2.destroy();

    c1 = new Chart(document.getElementById("chartPain"), {
        type: 'line',
        data: { labels: keys, datasets: [{ label: 'Douleur moyenne', data: pData, borderColor: '#a74d5e', tension: 0.3 }] },
        options: { scales: { y: { min: 0, max: 10 } } }
    });

    c2 = new Chart(document.getElementById("chartDays"), {
        type: 'bar',
        data: { labels: keys, datasets: [{ label: 'Dur√©e r√®gles (jours)', data: dData, backgroundColor: '#93b087' }] }
    });
}

function del(m, id) {
    const db = getDB();
    db.months[m].entries = db.months[m].entries.filter(x => x.id !== id);
    localStorage.setItem(DB_KEY, JSON.stringify(db));
    refresh();
}

function wipe() { if(confirm("Tout effacer ?")) { localStorage.clear(); location.reload(); } }
function exportJSON() {
    const blob = new Blob([localStorage.getItem(DB_KEY)], {type: "application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "suivi-cycle.json";
    a.click();
}

const today = new Date();
document.getElementById("configMonth").value = today.toISOString().slice(0,7);
document.getElementById("entryDate").value = today.toISOString().slice(0,10);
refresh();
</script>

</body>
</html>
