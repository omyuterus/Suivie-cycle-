<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mon suivi de cycle</title>

  <!-- FAVICONS (tu remplaceras les fichiers par ton brandmark) -->
  <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#a74d5e">

  <style>
    :root{
      --bg:#fbf7f4;
      --card:#ffffff;
      --text:#1f2937;
      --muted:#6b7280;
      --accent:#a74d5e;
      --accent2:#93b087;
      --accent3:#244135;
      --border:#eadfd7;
      --shadow: 0 10px 30px rgba(31,41,55,.08);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans";
      background: radial-gradient(1200px 600px at 10% 10%, rgba(167,77,94,.10), transparent 60%),
                  radial-gradient(1000px 500px at 90% 20%, rgba(147,176,135,.14), transparent 60%),
                  var(--bg);
      color:var(--text);
    }
    header{
      padding:20px 16px 8px;
      max-width:1120px;
      margin:0 auto;
    }
    .title{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .badge{
      font-size:12px;
      padding:6px 10px;
      border:1px solid var(--border);
      border-radius:999px;
      background:rgba(255,255,255,.7);
      color:var(--muted);
    }
    h1{margin:0;font-size:22px;letter-spacing:-.3px}
    p.lead{margin:10px 0 0;color:var(--muted);line-height:1.45;max-width:96ch}

    main{
      max-width:1120px;
      margin:0 auto;
      padding:16px;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:16px;
    }
    @media (max-width: 1000px){ main{grid-template-columns:1fr} }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
    }
    .card h2{margin:0 0 10px;font-size:16px;color:var(--accent3)}
    .note{
      background: rgba(147,176,135,.10);
      border:1px dashed rgba(147,176,135,.55);
      padding:10px 12px;
      border-radius:14px;
      font-size:13px;
      line-height:1.35;
      margin:10px 0 14px;
    }
    .note2{
      background: rgba(167,77,94,.08);
      border:1px dashed rgba(167,77,94,.35);
      padding:10px 12px;
      border-radius:14px;
      font-size:13px;
      line-height:1.35;
      margin:10px 0 14px;
    }
    .muted{color:var(--muted)}
    form{display:grid;gap:12px}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    input[type="text"], input[type="month"], input[type="date"], textarea, select, input[type="number"]{
      width:100%;
      padding:12px 12px;
      border:1px solid var(--border);
      border-radius:14px;
      outline:none;
      font-size:14px;
      background:#fff;
    }
    textarea{min-height:90px;resize:vertical}
    .row{display:grid;grid-template-columns: 1fr 1fr;gap:12px}
    @media (max-width:650px){ .row{grid-template-columns:1fr} }
    .chips{display:flex;flex-wrap:wrap;gap:8px}
    .chip{
      display:flex;align-items:center;gap:8px;
      padding:10px 12px;border:1px solid var(--border);
      border-radius:999px;background: rgba(255,255,255,.85);
      cursor:pointer;user-select:none;font-size:13px;color:var(--text);
    }
    .chip input{ accent-color: var(--accent); }
    .scale{
      display:grid;
      grid-template-columns: repeat(11, 1fr);
      gap:6px;align-items:center;
    }
    .scale input{
      width:100%;height:42px;border-radius:14px;border:1px solid var(--border);
      appearance:none;background:#fff;cursor:pointer;
    }
    .scale input:checked{
      border:2px solid var(--accent);
      box-shadow: 0 0 0 4px rgba(167,77,94,.12);
    }
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:4px}
    button{
      border:none;padding:12px 14px;border-radius:14px;cursor:pointer;
      font-weight:800;font-size:14px;
    }
    .btn-primary{background:var(--accent);color:#fff}
    .btn-secondary{background:rgba(147,176,135,.18);color:var(--accent3)}
    .btn-ghost{background:transparent;border:1px solid var(--border);color:var(--muted)}
    .btn-danger{background:rgba(167,77,94,.12);border:1px solid rgba(167,77,94,.25);color:var(--accent3)}
    .small{font-size:12px;color:var(--muted);line-height:1.35;margin:8px 0 0}
    .tabs{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap}
    .tab{
      padding:10px 12px;border-radius:999px;border:1px solid var(--border);
      background:#fff;cursor:pointer;font-size:13px;color:var(--muted);
    }
    .tab.active{
      color:var(--accent3);
      border-color: rgba(167,77,94,.35);
      box-shadow: 0 0 0 4px rgba(167,77,94,.10);
    }
    .list{display:grid;gap:10px}
    .entry{
      border:1px solid var(--border);
      border-radius:16px;
      padding:12px;
      background: rgba(251,247,244,.55);
    }
    .meta{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:6px;color:var(--muted);font-size:12px}
    .pill{padding:4px 8px;border-radius:999px;border:1px solid var(--border);background:#fff}
    .strong{font-weight:900;color:var(--accent3)}
    .divider{height:1px;background:rgba(234,223,215,.8);margin:12px 0}
    canvas{ width:100% !important; height:260px !important; }

    /* Discreet mode */
    #discreetOverlay{
      position:fixed; inset:0;
      background: linear-gradient(135deg, rgba(36,65,53,.92), rgba(167,77,94,.88));
      display:none;
      z-index:9999;
      color:#fff;
      padding:22px;
    }
    #discreetOverlay .box{
      max-width:520px;
      margin:12vh auto 0;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.22);
      border-radius:22px;
      padding:18px;
    }
    #discreetOverlay h3{margin:0 0 8px;font-size:18px}
    #discreetOverlay p{margin:0;color:rgba(255,255,255,.92);line-height:1.4}
    #discreetOverlay button{
      margin-top:14px;
      background:#fff;
      color:#111827;
      border:none;
      padding:12px 14px;
      border-radius:14px;
      font-weight:900;
      cursor:pointer;
      width:auto;
    }
  </style>
</head>

<body>
<div id="discreetOverlay">
  <div class="box">
    <h3>Mode discret ğŸ™ˆ</h3>
    <p>Tout est masquÃ©. Tu peux revenir quand tu veux.</p>
    <button id="discreetBackBtn" type="button">RÃ©afficher</button>
  </div>
</div>

<header>
  <div class="title">
    <h1>Mon suivi de cycle ğŸŒ™</h1>
    <span class="badge">Confidentiel Â· enregistrÃ© sur TON appareil</span>
    <span class="badge">Tu peux modifier ton mois Ã  tout moment</span>
    <span class="badge">Conseils + graphiques</span>
  </div>
  <p class="lead">
    Tu notes ce que tu veux, quand tu veux. Objectif : comprendre ton corps (sans te prendre la tÃªte).
  </p>
</header>

<main>
  <!-- LEFT -->
  <section class="card">
    <h2>ğŸ“Œ Mois + EntrÃ©es</h2>

    <div class="note">
      âœ… Tu peux faire plusieurs â€œentrÃ©esâ€ dans le mois (ovulation, douleur, plantes, humeurâ€¦).<br>
      âœ… Tout reste sur lâ€™appareil. Personne ne voit.
    </div>

    <div class="actions" style="margin-bottom:10px;">
      <button class="btn-ghost" type="button" id="discreetBtn">ğŸ™ˆ Mode discret</button>
    </div>

    <form id="monthForm">
      <div class="row">
        <div>
          <label for="month">Mois</label>
          <input id="month" type="month" required />
        </div>
        <div>
          <label for="nickname">PrÃ©nom / pseudo (facultatif)</label>
          <input id="nickname" type="text" placeholder="ex : Lina / Lili / ğŸŒ¸" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="startDate">DÃ©but des rÃ¨gles</label>
          <input id="startDate" type="date" />
        </div>
        <div>
          <label for="endDate">Fin des rÃ¨gles</label>
          <input id="endDate" type="date" />
        </div>
      </div>

      <!-- RAMADAN (manuel) -->
      <div class="note2">
        <div class="strong">ğŸŒ™ Ramadan (manuel, pour que Ã§a marche mÃªme aprÃ¨s)</div>
        <div class="small muted">Tu peux Ã©crire ton total Ã  rattraper + noter au fur et Ã  mesure ce que tu as dÃ©jÃ  rattrapÃ©.</div>
      </div>

      <div class="row">
        <div>
          <label class="chip" style="justify-content:center; width:100%;">
            <input type="checkbox" id="ramadan" />
            Jâ€™ai des jours Ã  rattraper (Ramadan)
          </label>
        </div>
        <div>
          <label for="ramadanTotal">Total de jours Ã  rattraper (manuel)</label>
          <input id="ramadanTotal" type="number" min="0" step="1" placeholder="ex : 6" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="ramadanDone">Jours dÃ©jÃ  rattrapÃ©s (manuel)</label>
          <input id="ramadanDone" type="number" min="0" step="1" placeholder="ex : 2" />
        </div>
        <div>
          <label>Jours restants</label>
          <input id="ramadanRemaining" type="text" disabled />
        </div>
      </div>

      <div class="note2" id="monthStatusBox"></div>

      <div class="actions">
        <button class="btn-secondary" type="button" id="saveMonthBtn">Enregistrer / mettre Ã  jour le mois</button>
        <button class="btn-ghost" type="button" id="exportMonthBtn">ğŸ“„ Export rÃ©sumÃ© (texte)</button>
      </div>

      <div class="divider"></div>

      <h2 style="margin-top:0;">â• Ajouter une entrÃ©e</h2>
      <div class="note">
        Une entrÃ©e = un mini pointage. Tu peux en faire autant que tu veux (mÃªme tous les jours).
      </div>

      <div class="row">
        <div>
          <label for="entryDate">Date</label>
          <input id="entryDate" type="date" required />
        </div>
        <div>
          <label for="entryType">Type</label>
          <select id="entryType" required>
            <option value="" selected disabled>Choisirâ€¦</option>
            <option value="ovulation">Ovulation / signes</option>
            <option value="regles">RÃ¨gles / douleur</option>
            <option value="spm">SPM / humeur / stress</option>
            <option value="plantes">Plantes prises</option>
            <option value="alimentation">Alimentation (simple)</option>
            <option value="note">Note libre</option>
          </select>
        </div>
      </div>

      <!-- OVULATION -->
      <div id="ovulationBlock" style="display:none;">
        <label>Ovulation : signes</label>
        <div class="chips">
          <label class="chip"><input type="checkbox" name="ovuSigns" value="Tiraillement ovaire"> Tiraillement ovaire</label>
          <label class="chip"><input type="checkbox" name="ovuSigns" value="Pertes plus gluantes"> Pertes plus gluantes</label>
          <label class="chip"><input type="checkbox" name="ovuSigns" value="Pertes plus abondantes"> Pertes plus abondantes</label>
          <label class="chip"><input type="checkbox" name="ovuSigns" value="Ã‰nergie diffÃ©rente"> Ã‰nergie diffÃ©rente</label>
        </div>

        <div class="row" style="margin-top:10px;">
          <div>
            <label>Si tiraillement : cÃ´tÃ© ?</label>
            <select id="ovuSide">
              <option value="" selected>Je ne sais pas / pas ressenti</option>
              <option value="gauche">Gauche</option>
              <option value="droite">Droite</option>
            </select>
          </div>
          <div>
            <label>Pertes : aspect</label>
            <select id="mucusType">
              <option value="" selected>Je ne sais pas</option>
              <option value="crÃ©meux">CrÃ©meux / blanc</option>
              <option value="gluant">Gluant / â€œblanc dâ€™Å“ufâ€</option>
              <option value="aqueux">Aqueux</option>
              <option value="sec">Sec / peu</option>
            </select>
          </div>
        </div>
      </div>

      <!-- REGLES / DOULEUR : OUI/NON + dÃ©tails si OUI -->
      <div id="painBlock" style="display:none;">
        <label>As-tu eu mal aujourdâ€™hui ?</label>
        <div class="chips">
          <label class="chip"><input type="radio" name="painYesNo" value="oui"> Oui</label>
          <label class="chip"><input type="radio" name="painYesNo" value="non"> Non</label>
        </div>

        <div id="painDetails" style="display:none; margin-top:10px;">
          <label>Si oui : oÃ¹ ?</label>
          <div class="chips">
            <label class="chip"><input type="checkbox" name="painWhere" value="Bas-ventre"> Bas-ventre</label>
            <label class="chip"><input type="checkbox" name="painWhere" value="Dos / reins"> Dos / reins</label>
            <label class="chip"><input type="checkbox" name="painWhere" value="Entre les jambes"> Entre les jambes</label>
            <label class="chip"><input type="checkbox" name="painWhere" value="Autre"> Autre</label>
          </div>

          <div style="margin-top:10px;">
            <label>IntensitÃ© (0â€“10)</label>
            <div class="scale" id="painScale"></div>
          </div>
        </div>
      </div>

      <!-- SPM -->
      <div id="spmBlock" style="display:none;">
        <label>SPM / humeur (tu peux cocher plusieurs)</label>
        <div class="chips">
          <label class="chip"><input type="checkbox" name="mood" value="Calme"> ğŸ™‚ Calme</label>
          <label class="chip"><input type="checkbox" name="mood" value="StressÃ©e"> ğŸ˜µ StressÃ©e</label>
          <label class="chip"><input type="checkbox" name="mood" value="FatiguÃ©e"> ğŸ˜´ FatiguÃ©e</label>
          <label class="chip"><input type="checkbox" name="mood" value="Irritable"> ğŸ˜¤ Irritable</label>
          <label class="chip"><input type="checkbox" name="mood" value="Sensible"> ğŸ¥º Sensible</label>
          <label class="chip"><input type="checkbox" name="mood" value="Envie de sucre"> ğŸ« Envie de sucre</label>
          <label class="chip"><input type="checkbox" name="mood" value="Ballonnements"> ğŸˆ Ballonnements</label>
          <label class="chip"><input type="checkbox" name="mood" value="Maux de tÃªte"> ğŸ¤• Maux de tÃªte</label>
        </div>
      </div>

      <!-- PLANTES -->
      <div id="plantsBlock" style="display:none;">
        <label>Quâ€™as-tu pris aujourdâ€™hui ?</label>
        <div class="chips">
          <label class="chip"><input type="checkbox" name="plants" value="Camomille"> ğŸŒ¼ Camomille</label>
          <label class="chip"><input type="checkbox" name="plants" value="MÃ©lisse"> ğŸƒ MÃ©lisse</label>
          <label class="chip"><input type="checkbox" name="plants" value="Verveine"> ğŸŒ¿ Verveine</label>
          <label class="chip"><input type="checkbox" name="plants" value="Djeka"> ğŸ«– Djeka</label>
          <label class="chip"><input type="checkbox" name="plants" value="KhamarÃ©"> ğŸ«– KhamarÃ©</label>
        </div>

        <div class="row" style="margin-top:10px;">
          <div>
            <label>Combien de tasses ?</label>
            <select id="cups">
              <option value="0" selected>0</option>
              <option value="1">1</option>
              <option value="2">2</option>
            </select>
          </div>
          <div>
            <label>Moment</label>
            <select id="whenCups">
              <option value="" selected>â€”</option>
              <option value="matin">Matin</option>
              <option value="aprÃ¨s-midi">AprÃ¨s-midi</option>
              <option value="soir">Soir</option>
              <option value="dÃ¨s la douleur">DÃ¨s la douleur</option>
            </select>
          </div>
        </div>
      </div>

      <!-- ALIMENTATION -->
      <div id="foodBlock" style="display:none;">
        <label>Alimentation (simple, sans jugement)</label>
        <div class="chips">
          <label class="chip"><input type="checkbox" name="food" value="Jâ€™ai bu de lâ€™eau"> ğŸ’§ Jâ€™ai bu de lâ€™eau</label>
          <label class="chip"><input type="checkbox" name="food" value="Jâ€™ai mangÃ© maison"> ğŸ² PlutÃ´t maison</label>
          <label class="chip"><input type="checkbox" name="food" value="Fast-food / ultra transformÃ©"> ğŸŸ Fast-food / ultra transformÃ©</label>
          <label class="chip"><input type="checkbox" name="food" value="Beaucoup de sucre"> ğŸ« Beaucoup de sucre</label>
          <label class="chip"><input type="checkbox" name="food" value="Fruits / lÃ©gumes"> ğŸ Fruits / lÃ©gumes</label>
        </div>
      </div>

      <!-- CONSEIL DYNAMIQUE -->
      <div class="note2" id="adviceBox" style="display:none;"></div>

      <div>
        <label for="entryNotes">Note (facultatif)</label>
        <textarea id="entryNotes" placeholder="ex : journÃ©e stressante / mauvaise nuit / jâ€™ai pris 1 tasseâ€¦"></textarea>
      </div>

      <div class="actions">
        <button class="btn-primary" type="button" id="addEntryBtn">Enregistrer cette entrÃ©e âœ¨</button>
        <button class="btn-ghost" type="button" id="clearEntryBtn">Vider lâ€™entrÃ©e</button>
      </div>

      <p class="small">
        âš ï¸ Si douleur trÃ¨s forte, malaise, vomissements, rÃ¨gles trÃ¨s abondantes â†’ parle Ã  un adulte et consulte.
      </p>
    </form>
  </section>

  <!-- RIGHT -->
  <aside class="card">
    <h2>ğŸ§° Mes solutions (toujours au mÃªme endroit)</h2>

    <div class="note">
      <div class="strong">Quand jâ€™ai mal tout de suite :</div>
      â€¢ Bouillotte / chaleur bas-ventre ou bas du dos<br>
      â€¢ Positions : sur le cÃ´tÃ© genoux repliÃ©s / recroquevillÃ©e<br>
      â€¢ Respiration lente 2â€“3 minutes<br>
      â€¢ Repos + eau<br>
    </div>

    <div class="note2">
      <div class="strong">Plantes douces (semaine AVANT les rÃ¨gles, stress/SPM) :</div>
      <b>Camomille / MÃ©lisse / Verveine</b><br>
      â€¢ Infusion 5â€“10 min<br>
      â€¢ 1 tasse le soir (ou 1â€“2 tasses/jour si besoin)<br>
    </div>

    <div class="note">
      <div class="strong">Djeka & KhamarÃ© (prÃ©vention + instant T) :</div>
      <b>PrÃ©paration</b> : rincer â†’ casserole dâ€™eau â†’ <b>bouillir 10 min</b> â†’ filtrer â†’ boire chaud ou refroidir.<br>
      <b>RÃ©utilisable</b> : mÃªmes plantes jusquâ€™Ã  <b>2 fois</b> (2 dÃ©coctions max).<br><br>
      <b>PrÃ©vention</b> : 1 tasse/jour pendant <b>3 jours autour de lâ€™ovulation</b>, Ã  rÃ©pÃ©ter <b>3 cycles</b>, puis pause.<br>
      <b>Pendant les rÃ¨gles</b> : 1 tasse dÃ¨s que la douleur arrive.<br>
    </div>

    <div class="note2">
      <div class="strong">Alimentation â€œanti-douleurâ€ (sans privation) :</div>
      â€¢ Si tu as mal : rÃ©duire un peu <b>trop de sucre + ultra-transformÃ©</b> quelques jours.<br>
      â€¢ Ajouter : <b>eau</b> + repas simple + fruits/lÃ©gumes.<br>
      â€¢ Oui tu peux manger un tacos ğŸ˜„ mais ton corps dit merci quand tu Ã©quilibres.
    </div>

    <div class="divider"></div>

    <h2>ğŸ“Š RÃ©cap & Graphiques</h2>
    <div class="tabs">
      <button class="tab active" data-tab="overview" type="button">Graphiques</button>
      <button class="tab" data-tab="current" type="button">Mois</button>
      <button class="tab" data-tab="history" type="button">Historique</button>
    </div>

    <div id="tab-overview">
      <canvas id="painChart"></canvas>
      <div style="height:10px"></div>
      <canvas id="durationChart"></canvas>
    </div>

    <div id="tab-current" style="display:none;">
      <div id="currentMonthBox" class="note"></div>
      <div class="list" id="currentEntriesList"></div>
    </div>

    <div id="tab-history" style="display:none;">
      <div class="actions" style="margin-bottom:10px;">
        <button class="btn-danger" type="button" id="clearAllBtn">Tout supprimer (cet appareil)</button>
        <button class="btn-ghost" type="button" id="exportBtn">Exporter (JSON)</button>
      </div>
      <div class="list" id="monthsList"></div>
    </div>
  </aside>
</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
  const LS_KEY = "cycle_months_final_v2";

  function loadMonths(){ try { return JSON.parse(localStorage.getItem(LS_KEY) || "[
