<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mon suivi du cycle üåô</title>

  <style>
    :root{
      --bg:#fbf7f4; --card:#ffffff; --text:#1f2937; --muted:#6b7280;
      --accent:#a74d5e; --green:#93b087; --dark:#244135; --border:#eadfd7;
      --shadow: 0 10px 30px rgba(31,41,55,.08); --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: system-ui, -apple-system, sans-serif;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(167,77,94,.10), transparent 60%), var(--bg);
      color:var(--text); line-height: 1.5;
    }
    header, main{ max-width:1120px; margin:0 auto; padding:16px; }
    h1{ margin:0; font-size:22px; }
    .badge{ font-size:12px; padding:6px 10px; border:1px solid var(--border); border-radius:999px; background:#fff; color:var(--muted); margin-right:5px; }
    main{ display:grid; grid-template-columns: 1.1fr .9fr; gap:16px; }
    @media (max-width: 1000px){ main{ grid-template-columns:1fr; } }
    .card{ background:var(--card); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); padding:20px; margin-bottom:16px; }
    .note{ background: rgba(147,176,135,.10); border:1px dashed var(--green); padding:12px; border-radius:14px; font-size:13px; margin:10px 0; }
    .note2{ background: rgba(167,77,94,.08); border:1px dashed var(--accent); padding:12px; border-radius:14px; font-size:13px; margin:10px 0; }
    label{ font-size:13px; color:var(--muted); display:block; margin-bottom:5px; font-weight: bold; }
    input, select, textarea{ width:100%; padding:12px; border:1px solid var(--border); border-radius:14px; outline:none; font-size:14px; margin-bottom:10px; }
    .row{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .chips{ display:flex; flex-wrap:wrap; gap:8px; margin-bottom:10px; }
    .chip{ display:flex; align-items:center; gap:8px; padding:8px 12px; border:1px solid var(--border); border-radius:999px; background:#fff; cursor:pointer; font-size:13px; }
    .chip input{ accent-color: var(--accent); width: auto; margin:0; }
    .scale{ display:grid; grid-template-columns: repeat(11, 1fr); gap:4px; }
    .scale input{ appearance:none; height:35px; border:1px solid var(--border); border-radius:8px; cursor:pointer; display:flex; align-items:center; justify-content:center; }
    .scale input:checked{ border:2px solid var(--accent); background: rgba(167,77,94,.1); }
    .scale input::before{ content: attr(title); font-size:11px; }
    button{ border:none; padding:12px 14px; border-radius:14px; cursor:pointer; font-weight:800; font-size:14px; }
    .btn-primary{ background:var(--accent); color:#fff; width: 100%; }
    .btn-secondary{ background:rgba(147,176,135,.2); color:var(--dark); margin-top:5px; }
    .btn-ghost{ background:transparent; border:1px solid var(--border); color:var(--muted); }
    .tabs{ display:flex; gap:8px; margin-bottom:15px; }
    .tab{ padding:10px 15px; border-radius:999px; border:1px solid var(--border); background:#fff; cursor:pointer; font-size:13px; }
    .tab.active{ border-color: var(--accent); background: rgba(167,77,94,0.05); font-weight: bold; }
    .entry{ border:1px solid var(--border); border-radius:15px; padding:12px; margin-bottom:10px; background: #fafafa; }
    canvas{ width:100% !important; max-height:250px; }
  </style>
</head>

<body>
<header>
  <h1>Mon suivi du cycle üåô</h1>
  <p style="color:var(--muted); font-size:14px;">Espace personnel pour √©couter ton corps.</p>
</header>

<main>
  <section>
    <div class="card">
      <h2>üìÖ Le mois</h2>
      <div class="row">
        <div><label>Mois</label><input type="month" id="mainMonth"></div>
        <div><label>Pseudo</label><input type="text" id="nickname" placeholder="üå∏"></div>
      </div>
      <div class="row">
        <div><label>D√©but r√®gles</label><input type="date" id="startDate"></div>
        <div><label>Fin r√®gles</label><input type="date" id="endDate"></div>
      </div>
      
      <div class="note2">
        <label><input type="checkbox" id="ramadanMode" style="width:auto;"> J'ai des jours √† rattraper (Ramadan)</label>
        <div id="ramadanFields" style="display:none; margin-top:10px;">
          <div class="row">
            <div><label>Total √† rattraper</label><input type="number" id="ramTotal"></div>
            <div><label>D√©j√† faits</label><input type="number" id="ramDone"></div>
          </div>
          <button class="btn-secondary" onclick="addRamDay()">+1 jour rattrap√©</button>
        </div>
      </div>
      <button class="btn-primary" onclick="saveMonth()">Enregistrer les dates du mois</button>
    </div>

    <div class="card">
      <h2>‚ûï Note du jour</h2>
      <label>Date</label><input type="date" id="entryDate">
      
      <label>Humeur / Ressenti</label>
      <div class="chips">
        <label class="chip"><input type="checkbox" name="mood" value="Calme"> üôÇ Calme</label>
        <label class="chip"><input type="checkbox" name="mood" value="Stress√©e"> üòµ Stress√©e</label>
        <label class="chip"><input type="checkbox" name="mood" value="Fatigu√©e"> üò¥ Fatigu√©e</label>
        <label class="chip"><input type="checkbox" name="mood" value="Irritable"> üò§ Irritable</label>
        <label class="chip"><input type="checkbox" name="mood" value="Sensible"> ü•∫ Sensible</label>
        <label class="chip"><input type="checkbox" name="mood" value="Sucre"> üç´ Sucre</label>
      </div>

      <label>Douleurs aujourd'hui ?</label>
      <select id="hasPain" onchange="togglePain()">
        <option value="non">Non</option>
        <option value="oui">Oui</option>
      </select>
      
      <div id="painBlock" style="display:none;">
        <label>O√π as-tu mal ?</label>
        <div class="chips">
          <label class="chip"><input type="checkbox" name="where" value="Bas-ventre"> Bas-ventre</label>
          <label class="chip"><input type="checkbox" name="where" value="Dos"> Dos</label>
          <label class="chip"><input type="checkbox" name="where" value="Jambes"> Jambes</label>
        </div>
        <label>Intensit√© (0 √† 10)</label>
        <div class="scale" id="painScale"></div>
      </div>

      <label>Qu'as-tu utilis√© ?</label>
      <div class="chips">
        <label class="chip"><input type="checkbox" name="took" value="Bouillotte"> üî• Bouillotte</label>
        <label class="chip"><input type="checkbox" name="took" value="Djeka/Khamar√©"> ü´ñ Djeka/Khamar√©</label>
        <label class="chip"><input type="checkbox" name="took" value="Tisane"> üåº Tisane</label>
        <label class="chip"><input type="checkbox" name="took" value="Rien"> ü§ç Rien</label>
      </div>
      
      <label>Est-ce que √ßa t'a aid√©e ?</label>
      <select id="helpful">
        <option value="">Choisir...</option>
        <option>Oui beaucoup</option>
        <option>Un peu</option>
        <option>Pas vraiment</option>
      </select>

      <label>Notes libres</label><textarea id="dailyNotes"></textarea>
      <button class="btn-primary" onclick="addEntry()">Enregistrer cette note ‚ú®</button>
    </div>
  </section>

  <aside>
    <div class="card">
      <h2>üåø Mes solutions Naturo</h2>
      <div class="note"><b>Douleurs :</b> Chaleur (bouillotte), repos et respiration ventrale.</div>
      <div class="note2"><b>Djeka / Khamar√© :</b> Infusion chaude. Bouillir 10 min. Aide √† apaiser d√®s la douleur.</div>
      <div class="note"><b>Alimentation :</b> Favorise l'eau, les l√©gumes et √©vite le sucre en p√©riode de r√®gles.</div>
    </div>

    <div class="card">
      <div class="tabs">
        <button class="tab active" onclick="switchTab('list')">Notes</button>
        <button class="tab" onclick="switchTab('charts')">Graphiques</button>
      </div>
      <div id="view-list">
        <div id="ramadanStatus" class="note2" style="display:none;"></div>
        <div id="entriesList"></div>
      </div>
      <div id="view-charts" style="display:none;">
        <canvas id="painChart"></canvas><canvas id="durationChart"></canvas>
      </div>
      <button class="btn-ghost" style="width:100%;" onclick="clearAll()">Tout effacer</button>
    </div>
  </aside>
</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
const LS_KEY = "cycle_app_v5";
const scaleDiv = document.getElementById("painScale");
for(let i=0; i<=10; i++){ scaleDiv.innerHTML += `<input type="radio" name="pLvl" value="${i}" title="${i}" ${i===0?'checked':''}>`; }

function togglePain(){ document.getElementById("painBlock").style.display = (document.getElementById("hasPain").value === 'oui' ? 'block' : 'none'); }
document.getElementById("ramadanMode").onchange = function(){ document.getElementById("ramadanFields").style.display = this.checked ? 'block' : 'none'; };

function getData(){ return JSON.parse(localStorage.getItem(LS_KEY) || '{"months":{}}'); }

function saveMonth(){
    const data = getData(); const m = document.getElementById("mainMonth").value; if(!m) return alert("Choisis le mois !");
    data.months[m] = data.months[m] || { entries: [] };
    data.months[m].info = { 
        start: document.getElementById("startDate").value, end: document.getElementById("endDate").value,
        ramActive: document.getElementById("ramadanMode").checked, ramTotal: document.getElementById("ramTotal").value, ramDone: document.getElementById("ramDone").value 
    };
    localStorage.setItem(LS_KEY, JSON.stringify(data)); render(); alert("Dates enregistr√©es !");
}

function addRamDay(){ 
    let d = document.getElementById("ramDone"); d.value = parseInt(d.value || 0) + 1; saveMonth(); 
}

function addEntry(){
    const data = getData(); const m = document.getElementById("mainMonth").value; if(!m) return alert("Choisis le mois en haut !");
    const entry = {
        id: Date.now(), date: document.getElementById("entryDate").value,
        moods: Array.from(document.querySelectorAll('input[name="mood"]:checked')).map(e=>e.value),
        hasPain: document.getElementById("hasPain").value,
        pLvl: document.querySelector('input[name="pLvl"]:checked').value,
        where: Array.from(document.querySelectorAll('input[name="where"]:checked')).map(e=>e.value),
        took: Array.from(document.querySelectorAll('input[name="took"]:checked')).map(e=>e.value),
        helpful: document.getElementById("helpful").value, notes: document.getElementById("dailyNotes").value
    };
    data.months[m].entries.push(entry); localStorage.setItem(LS_KEY, JSON.stringify(data)); render(); alert("Note ajout√©e !");
}

let pChart, dChart;
function switchTab(t){
    document.getElementById('view-list').style.display = (t==='list'?'block':'none');
    document.getElementById('view-charts').style.display = (t==='charts'?'block':'none');
    document.querySelectorAll('.tab').forEach(x=>x.classList.toggle('active', x.innerText.toLowerCase().includes(t.slice(0,2))));
    if(t==='charts') buildCharts();
}

function render(){
    const data = getData(); const m = document.getElementById("mainMonth").value; const list = document.getElementById("entriesList"); const rb = document.getElementById("ramadanStatus");
    list.innerHTML = ""; if(!data.months[m]) return;
    const info = data.months[m].info; if(info && info.ramActive){ rb.style.display="block"; rb.innerHTML = `üåô <b>Ramadan :</b> ${info.ramDone||0}/${info.ramTotal||0} faits.`; } else rb.style.display="none";
    data.months[m].entries.sort((a,b)=>new Date(b.date)-new Date(a.date)).forEach(e=>{
        const d = document.createElement("div"); d.className="entry";
        d.innerHTML = `<b>üìÖ ${e.date}</b><br>${e.moods.join(' ')}<br>${e.hasPain==='oui'?`Pain: ${e.pLvl}/10 (${e.where.join(', ')})`:''}<br>üåø ${e.took.join(', ')}<br><i>${e.notes}</i>`;
        list.appendChild(d);
    });
}

function buildCharts(){
    const data = getData(); const ms = Object.keys(data.months).sort();
    const pains = ms.map(m => data.months[m].entries.reduce((a,c)=>a+parseInt(c.pLvl),0)/data.months[m].entries.length || 0);
    const durs = ms.map(m => (new Date(data.months[m].info.end)-new Date(data.months[m].info.start))/86400000+1 || 0);
    if(pChart) pChart.destroy(); if(dChart) dChart.destroy();
    pChart = new Chart(document.getElementById("painChart"), { type:'line', data:{labels:ms, datasets:[{label:'Douleur moyenne', data:pains, borderColor:'#a74d5e'}]}});
    dChart = new Chart(document.getElementById("durationChart"), { type:'bar', data:{labels:ms, datasets:[{label:'Dur√©e r√®gles', data:durs, backgroundColor:'#93b087'}]}});
}

function clearAll(){ if(confirm("Tout effacer ?")){ localStorage.clear(); location.reload(); } }
const d = new Date(); document.getElementById("mainMonth").value = d.toISOString().slice(0,7);
document.getElementById("entryDate").value = d.toISOString().slice(0,10); render();
</script>
</body>
</html>
